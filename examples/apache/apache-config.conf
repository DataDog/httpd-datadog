<VirtualHost *:8888>
    ServerName localhost

    # Proxy configuration to the Node.js HTTP service
    ProxyPreserveHost On
    ProxyPass /healthcheck !
    ProxyPass / http://httpjs:8080/
    ProxyPassReverse / http://httpjs:8080/

    # Create healthcheck endpoint
    Alias /healthcheck /app/healthcheck.json

    # Log configuration with Datadog trace correlation
    LogFormat "%h %l %u %t \"%r\" %>s %b %D \"%{Referer}i\" \"%{User-Agent}i\" \"%{X-Forwarded-For}i\" dd.trace_id=\"%{Datadog-Trace-ID}e\" dd.span_id=\"%{Datadog-Span-ID}e\"" datadog_combined
    CustomLog /proc/self/fd/1 datadog_combined
    ErrorLog /proc/self/fd/2

    # MIME types
    AddType text/html .html
    AddType text/plain .txt .log .conf
    AddType application/json .json

    ErrorDocument 404 "Not Found"
</VirtualHost>

# Extended status for more metrics (must be outside VirtualHost)
ExtendedStatus On

# Additional VirtualHost for Apache status monitoring (port 81)
<VirtualHost *:81>
    ServerName _
    
    <Location "/server-status">
        SetHandler server-status
        Require all granted
    </Location>
</VirtualHost>